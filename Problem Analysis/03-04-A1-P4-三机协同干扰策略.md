# 问题 4 — 建模（FY1、FY2、FY3 各投放 1 枚烟幕弹，对 M1 干扰；结果写入 `result2.xlsx`）

下面把问题 4 完整公式化：**决策变量 → 约束 → 运动学方程 → 遮蔽判定 → 目标函数 → 数值求解/优化建议 → 与 `result2.xlsx` 字段的对应关系**。我将沿用之前问题里相同的几何/物理假设（烟幕球半径 $R=10$ m，云团起爆后 20 s 有效，云团向下沉速 $v_{\rm sink}=3$ m/s，弹体受重力 $g=9.8$ m/s²；导弹与 UAV 初始位置与速度参考题面）。

---

## 1) 决策变量（总体）

三架无人机 $k=1,2,3$（FY1,FY2,FY3）各自可独立决策：

* 航向角 $\alpha_k$（度，0–360，x轴正向逆时针为正）
* 飞行速度 $v_{u,k}$（m/s，70 ≤ $v_{u,k}$ ≤ 140）
* 投放时刻 $t_{r,k}$（s，相对于任务下达 $t=0$）
* 引信延时（起爆延时） $\Delta_k$（s，≥0，可设上界例如 20 s）

决策向量：

$$
x = \big\{(\alpha_k, v_{u,k}, t_{r,k}, \Delta_k)\big\}_{k=1}^3.
$$

> 维数为 12（4 × 3）。投放点与起爆点由 $U_k(t)$、弹体运动学决定，不做独立变量。

---

## 2) 约束（显式）

* 速度约束： $70\le v_{u,k}\le140$.&#x20;
* 角度约束： $\alpha_k\in[0,360^\circ)$。
* 时间约束： $t_{r,k}\ge0$；各机投放若有任务限制可设上限（例如 $t_{r,k}\le T_{\max}$）。
* 同机投放间隔（题目要求，若同机多弹时适用）：这里每机仅投 1 枚，不用此约束。
* 起爆延时界： $0\le\Delta_k\le\Delta_{\max}$（建议 $\Delta_{\max}=20$ s 或由武器特性定）。
* 起爆高度约束：每枚起爆点高度 $z_{e,k}\ge 0$。若 $z_{e,k}<0$ 判为不可行或惩罚。
* 任务时序约束：投放/起爆需在导弹到达目标之前（即 $t_{e,k}<t_{\text{impact}}$），或设全局上界保证合理性。
* **安全间距（建议）**：保证三架 UAV 在任意时刻的最小相互距 $ \ge S_{\rm safe}$（例如 10–20 m），避免碰撞（可作为约束或惩罚项）。

---

## 3) 运动学方程（对每架 UAV、每枚弹）

与问题 1/2 的形式相同，下面以第 $k$ 架机符号化表示：

* 无人机单位航向向量

$$
\hat u_{u,k}(\alpha_k) = (\cos\alpha_k,\ \sin\alpha_k,\ 0).
$$

* 无人机轨迹（等高度匀速直线）

$$
U_k(t)=U_{0,k} + v_{u,k}\,\hat u_{u,k}\, t,
$$

其中 $U_{0,k}$ 为第 $k$ 架的初始三维坐标（题面给出）。

* 投放点（第 $k$ 枚）

$$
S_k = U_k(t_{r,k}).
$$

* 弹体起爆位置（在 $t_{e,k}=t_{r,k}+\Delta_k$）

$$
C_{0,k} = S_k + v_{u,k}\,\hat u_{u,k}\,\Delta_k + \tfrac12(0,0,-g)\Delta_k^2.
$$

* 起爆后云团中心随时间（有效区间 $t\in[t_{e,k},t_{e,k}+20]$）

$$
C_k(t) = C_{0,k} + (0,0,-v_{\rm sink})(t - t_{e,k}).
$$

* 导弹位置（同 M1）

$$
M(t)=M_0 + v_m\,\hat u_m\, t.
$$

---

## 4) 遮蔽判定与目标函数

对每一枚云团 $k$，在 $t\in[t_{e,k},t_{e,k}+20]$ 内，定义布尔函数

$$
\chi_k(t)=\mathbf{1}\{\ \mathrm{dist\_line\_segment}(C_k(t),\,M(t)\!-\!T)\le R\ \},
$$

其中 $\mathrm{dist\_line\_segment}(\cdot)$ 表示点到导弹—目标线段的最短距离（参见问题1的投影/截断公式）。

三云团合并的遮蔽指示函数（并集）

$$
\chi_{\text{union}}(t)=\max_{k=1,2,3} \chi_k(t).
$$

**目标（最大化）**

$$
T_{\text{shield,total}}(x)=\int_{0}^{\infty}\chi_{\text{union}}(t)\,dt
= \int \mathbf{1}_{\bigcup_{k}[t_{e,k},t_{e,k}+20]\cap\{d_k(t)\le R\}}\,dt,
$$

其中 $d_k(t)$ 为对应的点到线段距离。

**可选次级目标/目标组合**

* 最大化并集时长为首要目标。
* 若希望减少资源浪费，可令目标为“并集时长 − $\lambda$ ×（云团交叠时长总和）”，鼓励云团时空分布避免过多重叠。
* 或者做多目标：最大化并集时长 & 最小化总油耗/任务时间等。

---

## 5) 数值求解建议（算法与步骤）

这是 12 维连续的非光滑全局优化问题。推荐的求解流程（实际实现时按计算预算选择）：

### A. 评估器（核心）

写一个 `evaluate_Tshield_total(x)` 函数，输入 x（12 维），返回并集遮蔽时长（秒）：

* 计算每架 UAV 的 $S_k, C_{0,k}, t_{e,k}$。若任何 $z_{e,k}<0$ 或不可行，返回极小值（惩罚）。
* 在时间区间 $[ \min_k t_{e,k},\ \max_k (t_{e,k}+20)]$ 以步长 $\Delta t$ 采样（建议先 0.05–0.1 s 粗采样），对每个 t 计算每个 $d_k(t)$，得到 $\chi_{\text{union}}(t)$。
* 并集时长 ≈ $\sum \chi_{\text{union}}(t_i)\Delta t$。对候选最优解用小步长（0.005–0.02 s）精化，并用二分法求边界根以获得更精确值（见问题1 的根求法建议）。

### B. 优化器（全局搜索 + 局部精炼）

* **第一阶段（全局）**：使用差分进化（DE）或 CMA-ES 搜索全局最优（不需梯度）。并行化评估（每个个体一次仿真）可显著加速。
* **第二阶段（局部）**：对 DE/CMA-ES 最好若干解做局部精化（Nelder–Mead、Powell、L-BFGS-B 对平滑近似目标）。
* **第三阶段（精确评估）**：对最终候选用细时间步长和根求法精确计算 $T_{\text{shield,total}}$。

### C. 处理非光滑性（可选）

* 在全局阶段使用直接黑箱算法（DE/CMA-ES）。
* 若想使用基于梯度的优化，可对单次仿真目标使用光滑近似（例如 logistic 或高斯核平滑），见问题2 建议，然后在最后用硬阈值验证。

### D. 初始化策略（启发式）

* 初始候选可令三架 UAV 的航向分别指向原点（或略偏），速度取中值（例如 100 m/s），投放时间均匀分布在导弹到达前一段窗口，起爆延时设为使得起爆点落在导弹—目标线段附近靠近目标的一侧。直觉启发可以显著降低搜索难度。

### E. 约束处理

* 在优化过程中，把不满足 $z_{e,k}\ge0$、安全间距等约束的解设为不可行或给予大惩罚（penalty function），或者用投影法把变量映射到可行域。

---

## 6) 评估细节与数值建议

* 时间采样：初搜 $\Delta t=0.05$–0.1 s；精化 $\Delta t=0.005$–0.02 s。
* 判定边界精化：在 $\chi_{\text{union}}$ 从 0→1 或 1→0 的相邻采样点之间，用二分法求 $d_k(t)=R$ 的根，精度 $10^{-3}$–$10^{-4}$ s。
* 并集计算：若用采样法，通过布尔或集合操作合并三条遮蔽时间序列得到并集长度；也可对每枚弹分别求出若干遮蔽区间，再做区间并操作得到精确并集长度（更高效也更精确）。
* 若考虑安全间距或避碰，用额外函数检测 $ \|U_i(t)-U_j(t)\| < S_{\rm safe}$ 并拒绝该解（或加惩罚）。

---

## 7) 输出到 `result2.xlsx` 的填充说明（每行对应一架 UAV）

模板字段与填充方法：

| 字段              | 填充说明                                                                              |
| --------------- | --------------------------------------------------------------------------------- |
| 无人机编号           | FY1 / FY2 / FY3                                                                   |
| 无人机运动方向         | 优化得到的 $\alpha_k$（度）                                                               |
| 无人机运动速度 (m/s)   | 优化得到的 $v_{u,k}$                                                                   |
| 烟幕干扰弹投放点的 x,y,z | $S_k = U_k(t_{r,k})$ 的三分量                                                         |
| 烟幕干扰弹起爆点的 x,y,z | $C_{0,k}$ 的三分量                                                                    |
| 有效干扰时长 (s)      | 单枚遮蔽时长 $T_{\text{shield},k}=\int_{t_{e,k}}^{t_{e,k}+20}\chi_k(t)\,dt$（按硬阈值计算，单位秒） |

另外建议在另一个单元或附加表格里记录：**并集遮蔽时长** $T_{\text{shield,total}}$（这是最终评价指标），以及每枚弹的 $t_{r,k},\Delta_k,t_{e,k}$ 和 $T_{\text{shield},k}$ 的时间区间（例如列出每个遮蔽区间的起止时刻）。这样便于报告与可视化。

---

## 8) 伪代码（评估 + 优化主流程）

```
# 假定已知 M0, U0_k, T, v_m, R, v_sink, g
# 决策变量 x = [(alpha_k, v_u_k, t_r_k, Delta_k) for k=1..3]

def eval_candidate(x, dt=0.05):
    for k in 1..3:
        hat_u = (cos(alpha_k), sin(alpha_k), 0)
        S_k = U0_k + v_u_k * hat_u * t_r_k
        C0_k = S_k + v_u_k * hat_u * Delta_k + 0.5*(0,0,-g)*Delta_k^2
        t_e_k = t_r_k + Delta_k
        if C0_k.z < 0: return large_penalty
    # 并集时间区间
    t_start = min_k t_e_k
    t_end = max_k (t_e_k + 20)
    times = np.arange(t_start, t_end+dt, dt)
    union_flags = zeros_like(times)
    for idx,t in enumerate(times):
        for k in 1..3:
            if t < t_e_k or t > t_e_k+20: continue
            Ck = C0_k + (0,0,-v_sink)*(t - t_e_k)
            M = M0 + v_m * hat_u_m * t
            compute s_star, s_clamp, P as in Problem1
            d = norm(Ck - P)
            if d <= R: union_flags[idx] = 1; break
    T_union = sum(union_flags) * dt
    return T_union

# Global optimization (e.g., Differential Evolution)
best = differential_evolution(lambda x: -eval_candidate(x), bounds_for_12_vars)
# 对 best 用更小 dt 精化并用根求法求精确并集时长
```

---

## 9) 可选的高级扩展（若以后需要）

* **协调控制与相位分配**：将三架云团的起爆时序视为“覆盖窗口分配”问题，使用调度/序列优化思想（比如将每枚云团当作长度 ≤20 s 的覆盖片段，目标是覆盖导弹接近期间的最大总时间）——可转化为一维覆盖问题后再用反算 UAV 参数。此法能显著缩小搜索空间。
* **鲁棒/随机化**：若弹体受随机扰动或风场影响，可用蒙特卡罗评估期望遮蔽时长并优化期望值或分位数（鲁棒优化）。
* **多目标优化**：并集时长 + 最小化遮蔽重叠 + 最小化总消耗（速度/时间）等。

---

## 10) 验证与可视化建议

* 绘制三维轨迹（M(t), U\_k(t), C\_k(t)）与云团球面在若干时刻的剖面，直观验证覆盖位置与时序。
* 绘制随时间的 `d_k(t)` 与阈值线 $R$，标出每枚弹的遮蔽区间与三弹并集区间。
* 在 `result2.xlsx` 附上一行总体结果：并集遮蔽总时长 $T_{\text{shield,total}}$，以及每枚弹的 $t_{r,k},\Delta_k,t_{e,k}$。

---

### 小结

我已把**问题4**建模为一个 12 维连续优化问题，给出清晰的运动学方程、遮蔽判定、并集目标、约束以及详尽的数值求解流程与伪代码，并说明如何把每架无人机的结果填入 `result2.xlsx` 模板。你可以直接把以上公式与伪代码改写为 Python/MATLAB/C++ 并运行全局优化（差分进化/CMA-ES）来获得最终数值解；如需我把伪代码转换为你指定语言的完整模板（含并行化与文件写入到 `result2.xlsx`），我也可以生成。
