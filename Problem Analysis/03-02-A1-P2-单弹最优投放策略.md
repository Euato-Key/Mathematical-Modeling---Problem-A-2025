# 问题2 — 建模（单架 FY1、1 枚烟幕，最大化对 M1 的遮蔽时长）

下面把**决策变量 / 约束 / 目标函数 / 几何与运动方程 / 数值求解建议**全部公式化，给出可直接拿去编码求解的完整数学模型与优化策略。题面常量与初始位置按你给的数据取（若想改参只需替换常数即可）。

---

# 1. 决策变量（待优化）

以 $x$ 表示决策向量，包含四个连续变量：

* 飞行速度 $v_u$（m/s），约束： $70 \le v_u \le 140$.&#x20;
* 飞行方向（水平面航向角） $\alpha\in[0,2\pi)$。**题面说明无人机“等高度匀速直线”**，因此航向仅在水平平面内选取（不改变高度）。（单位向量 $\hat u_u=(\cos\alpha,\sin\alpha,0)$）
* 投放时刻 $t_r\ge0$（s）。（任务在 $t=0$ 下发，允许选择何时投放）
* 引信延时（起爆延时） $\Delta\ge0$（s），起爆时刻 $t_e=t_r+\Delta$。为避免不切实际值，建议加上上界，例如 $\Delta\in[0,\,20]$ 或由武器/任务限制给定。

可选：若你想把投放点直接作为优化变量可替代 $t_r$（等价，因为投放点由 $v_u,\alpha,t_r$ 决定）。

---

# 2. 约束（显式）

* 速度约束： $70\le v_u\le140$.&#x20;
* 航向角 $\alpha\in[0,2\pi)$。
* 时间约束： $t_r\ge0$；起爆必须落在导弹到达目标前： $t_e \le t_{\mathrm{impact}}$（可计算或设上界）。若不预先计算 $t_{\mathrm{impact}}$，可保守设 $t_r+\Delta\le T_{\max}$（例如 200 s），以避免搜索到无意义的极大延时。
* 起爆位置高度与地面关系：起爆时云团中心高度 $z_{C_0}$ 不应低于地面（或不可行），若起爆点 $C_0$ 的 $z$ 小于 0 则判为不可行（或对其惩罚）。

---

# 3. 几何/运动学（与问题1保持一致的表达式）

（简要列出供优化器内部用到的封装函数）

已知常量与位置：导弹初始 $M_0$，FY1 初始 $U_0$，目标参考点 $T$，导弹速 $v_m$，云团半径 $R=10$ m，云团下沉速 $v_{sink}=3$ m/s，重力 $g$。

1. 无人机单位航向向量（等高度）：

$$
\hat u_u(\alpha)=(\cos\alpha,\ \sin\alpha,\ 0).
$$

2. 无人机轨迹：

$$
U(t)=U_0 + v_u\,\hat u_u\, t.
$$

3. 投放点（在 $t=t_r$ 脱离）：

$$
S_0 = U(t_r)=U_0 + v_u\,\hat u_u\, t_r.
$$

4. 弹体起爆位置（起爆延时 $\Delta$）：
   设 $\Delta = \Delta$（可优化），

$$
C_0 = S_0 + v_u\,\hat u_u\,\Delta + \tfrac12(0,0,-g)\Delta^2.
$$

起爆时刻 $t_e=t_r+\Delta$。之后云团中心随时间：

$$
C(t)=C_0 + (0,0,-v_{sink})(t-t_e),\quad t\in[t_e,t_e+20].
$$

5. 导弹轨迹（同问题1）：

$$
\hat u_m = -\frac{M_0}{\|M_0\|},\qquad M(t)=M_0 + v_m\,\hat u_m\, t.
$$

6. 对任意时刻 $t$（在 $t_e\le t\le t_e+20$ 内）计算云团与导弹—目标线段的最短距离 $d(t)$（同问题1）：

* 投影系数

$$
s^*(t)=\frac{(C(t)-M(t))\cdot (T-M(t))}{\|T-M(t)\|^2},\quad s_{\mathrm{clamp}}=\mathrm{clip}(s^*,0,1).
$$

* 最近点 $P(t)=M(t)+s_{\mathrm{clamp}}(T-M(t))$，
* 距离 $d(t)=\|C(t)-P(t)\|$.

---

# 4. 目标函数（优化目标）

定义遮蔽指示函数

$$
\chi(t;x)=\begin{cases}
1,& t\in[t_e,t_e+20]\ \text{且}\ d(t)\le R,\\
0,& \text{otherwise},
\end{cases}
$$

其中 $x=(v_u,\alpha,t_r,\Delta)$。

**遮蔽总时长（要最大化）**

$$
T_{\mathrm{shield}}(x)=\int_{t_e}^{t_e+20} \chi(t;x)\,dt.
$$

这是目标：

$$
\max_{x\in\mathcal X} \; T_{\mathrm{shield}}(x)
\quad\text{s.t. constraints above.}
$$

备注：指标函数非光滑、非凸，存在离散跳变 —— 直接用常规梯度法会很困难。下面给出若干数值处理与优化策略。

---

# 5. 数值化与可微替代（便于优化器）

由于 $\chi$ 是阶跃型（0/1），建议用**光滑近似**来构造平滑可微目标，便于使用带梯度的优化器与加速收敛：

1. **Logistic 软指示**

$$
s_\kappa(d)=\frac{1}{1+\exp(\kappa (d-R))},
$$

其中 $\kappa>0$ 控制陡峭程度（$\kappa$ 越大越接近硬阈值）。近似遮蔽时长：

$$
\widetilde T_\kappa(x)=\int_{t_e}^{t_e+20} s_\kappa(d(t;x))\,dt.
$$

对数istic 平滑可以用自动微分计算梯度。

2. **高斯核平滑**

$$
s_\sigma(d)=\exp\!\big(-\tfrac{(d-R)^2}{2\sigma^2}\big),
$$

将积分作为近似目标（更偏重距离接近 R 的惩罚/奖励）。

在实现中，时间积分用数值求和（步长 $\Delta t$），所以目标变为离散和：

$$
\widetilde T_\kappa(x)\approx \sum_{i=0}^{N} s_\kappa\big(d(t_i;x)\big)\,\Delta t.
$$

选择合适 $\kappa$ / $\sigma$ 权衡可微性与逼近度。建议先用平滑目标找出好区，再用硬阈值对候选解做精确评价（采样或根求法）以获得真实 $T_{\mathrm{shield}}$。

---

# 6. 求解策略（推荐流程）

## A. 粗网格扫参 + 局部精修（稳健、易实现，适合先验少的情况）

1. 在 $v_u$（70–140）和 $\alpha$（0–2π）做粗格网（例如速度 8 点、角度 36 点），固定若干 $t_r$ 与 $\Delta$ 网格（例如分别 0–30 s 的若干点）。对每组参数计算 $T_{\mathrm{shield}}$（用采样法 $\Delta t=0.02$–0.1 s）。
2. 取若干最好解作为初始点，用局部优化（Nelder–Mead / L-BFGS-B 对平滑目标 / Powell 对无梯度）精修。
3. 对最终候选用硬阈值精确计算并评估真实遮蔽时长（用根求法精确定位边界）。

优点：简单，能发现全局区间；缺点：计算量受网格大小影响。

## B. 黑箱全局优化（适用于高维非光滑目标）

* **差分进化（Differential Evolution）** 或 **CMA-ES**：无需梯度、健壮对噪声和多峰。
* **贝叶斯优化（BO）**：当评估代价高（每次仿真很慢）且维度较低（<=6）时很好用，能减少评估次数。
* 在优化过程中用平滑目标 $\widetilde T_\kappa$ 加速收敛，最后对最优点用精确 $T_{\mathrm{shield}}$ 验证。

## C. 分解法（降维启发）

* 观察到：给定投放地点 $S_0$ 与起爆时刻 $t_e$，遮蔽时长只取决于 $C_0$（起爆位置）及 $t_e$。因此可先搜索“理想的起爆位置与时刻”，再反算必须的 $v_u,\alpha,t_r,\Delta$（若可实现则接受，否则投影到可行域）。
* 该方法把问题分成：在空间-时间上找最佳 $C_0, t_e$（4 维），再求解最小误差匹配到 FY1 运动学（包含弹道落差），是混合代数约束问题。对于某些情形可大幅缩小搜索空间。

---

# 7. 实现细节与数值建议

* 时间采样：对评估目标函数，用 $\Delta t=0.02$–0.05 s 作为折衷（可先用 0.1 s 粗扫）。最后对候选解用 $\Delta t=0.005$–0.01 s 精化边界。
* 根求法：一旦用采样定位出遮蔽起止的粗区间，用二分法在每个区间求解 $d(t)=R$ 的精确根（单调性一般成立于小区间内），精度设 $10^{-4}$ s。
* 可行性检查：若某参数组合导致投放/起爆 $z$ 低于地面或投放点超出无人机可到达范围（例如 $t_r$ 太大导致无人机撞地或超出作战半径），将该点标记不可行并给大惩罚。
* 多起爆限制：本问题只用 1 枚弹；若未来扩展到多弹，目标为覆盖时间的并集，可把目标改为并集长度或加权目标。

---

# 8. 可能的解析性观察（供降低搜索复杂度的启发）

* 最长遮蔽通常发生在“云团中心轨迹相对导弹—目标视线投影移动慢”的情形，也就是云团相对于导弹的横向速度（相对于视线方向）小，云团在视线上的投影残留时间更长。由此启发：优先选择让起爆点 $C_0$ 的投影尽量位于导弹-目标线远端（靠近目标一侧）且云团下沉方向不使投影快速离开视线。
* 若导弹与云团相对径向速度很大（导弹快速接近），延长遮蔽的空间策略是把云团放置在导弹到达目标前尽早交叉的地方并使其在导弹接近期间仍在视线附近（通过选择合适 $t_e$ 与 $C_0$）。这些直觉可用来构造初始猜测（例如把 $C_0$ 放在导弹-目标线段中点附近向靠近目标的一端）。

---

# 9. 伪代码（评估与优化主流程）

```
# 输入常量 M0, U0, T, v_m, R, v_sink, g
# 变量 x = (v_u, alpha, t_r, Delta)

def evaluate_Tshield(x, dt=0.02):
    compute hat_u_u(alpha)
    S0 = U0 + v_u*hat_u_u * t_r
    C0 = S0 + v_u*hat_u_u * Delta + 0.5*(0,0,-g)*Delta^2
    t_e = t_r + Delta
    if C0.z < 0: return -inf  # 不可行
    total = 0.0
    for t in np.arange(t_e, t_e+20+dt, dt):
        C = C0 + (0,0,-v_sink)*(t - t_e)
        M = M0 + v_m * hat_u_m * t
        compute d(t) as in section 3
        # 硬阈值：
        if d <= R: total += dt
        # 或平滑目标:
        # total += logistic(kappa*(R - d)) * dt
    return total

# 优化（例：差分进化）
best = differential_evolution(lambda x: -evaluate_Tshield(x), bounds)
# 最后对 best 用更精确 dt 或根求法评估真正的 T_shield
```

---

# 10. 推荐求解工具与算法

* **差分进化（scipy.optimize.differential\_evolution）**：易用、无需梯度，适合全局搜索。
* **CMA-ES（pycma）**：处理连续多峰优化表现好。
* **贝叶斯优化（scikit-optimize / GPyOpt）**：评价代价高时优先。
* **局部精炼**：对平滑目标用 L-BFGS-B；对非光滑用 Nelder–Mead / Powell。
* **并行化**：目标评估可并行（每个参数集为独立仿真），显著加速全局搜索。

---

# 11. 输出与验证

* 输出最优解 $x^*=(v_u^*,\alpha^*,t_r^*,\Delta^*)$ 与对应精确遮蔽时长 $T_{\mathrm{shield}}(x^*)$。
* 给出遮蔽时间段（可能是多个不连续区段），并绘图展示 $d(t)$ 与 $R$、三维轨迹图（导弹、无人机轨迹、云团中心轨迹）以验证几何直观。
* 若需要，将最优起爆点 $C_0$ 与投放点 $S_0$ 写入 `result` 表格。

---

# 12. 备注（可选复杂化/简化）

* **若允许无人机改变高度/曲线飞行**：需把方向参数化为三维，变量增维（航向与俯仰或完整三维速度矢量），并在模型中允许改向轨迹/动力学约束（这会显著增加复杂度）。
* **若考虑空气阻力与弹体横向紊动**：弹体轨迹需加入阻力或随机扰动，可用蒙特卡罗评估期望遮蔽时长。
* **若希望对 M2/M3 也防护**：目标函数扩展为各导弹遮蔽时间的加权和或并集时间，优化更复杂，建议采用多目标或加权单目标化。

---

## 小结

我已把**问题2**完全公式化为一个带约束的连续优化问题，给出了：

* 决策变量与约束；
* 精确的运动学/几何判定公式；
* 原始（非光滑）目标与可微近似目标；
* 几种实用的数值求解策略（粗网格+局部、差分进化/CMA-ES、贝叶斯优化等）；
* 实现要点（时间采样、根求法精化、可行性检测）与伪代码。

如果你愿意，我可以接着把（A）**用符号代数把 $d(t)^2-R^2$ 展开成关于 $t$ 的具体多项式/有理式表达**（便于用解析根求法）；或（B）把上面的伪代码直接给出成 Python / MATLAB 的完整模板（含差分进化调用与并行加速设置）。你想先要哪个？
